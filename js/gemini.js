function setError(e,t=!1){let n=document.getElementById("gemini-error"),a=document.getElementsByClassName("gemini-nano-error-catch");if(n&&(n.dataset.error=e),!0==t)for(let r=0;r<a.length;r++)a[r].style.display="none"}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function createCodeBlock(e,t){let n=document.createElement("div");return n.classList.add("code-block"),n.innerHTML=`<div class="code-header"><span class="code-language">${t}</span></div><pre><code class="language-${t}">${escapeHtml(e)}</code></pre>`,Prism.highlightElement(n.querySelector("code")),n}function extractCodeBlocks(e){let t=/```(\w+)?\n([\s\S]*?)```/g,n,a=[],r=0;for(;null!==(n=t.exec(e));){let s=n[1]||"text",l=n[2];n.index>r&&a.push({type:"text",content:e.slice(r,n.index)}),a.push({type:"code",content:l,language:s}),r=t.lastIndex}return r<e.length&&a.push({type:"text",content:e.slice(r)}),a}function renderResponse(e,t){let n=extractCodeBlocks(e),a=document.createElement("div");a.classList.add("chat-bubble"),n.forEach(e=>{if("text"===e.type)a.innerHTML+=escapeHtml(e.content);else if("code"===e.type){let t=createCodeBlock(e.content,e.language);a.appendChild(t)}}),t.appendChild(a)}document.addEventListener("DOMContentLoaded",async function(){try{let e=null!=window.ai,t="readily"===(e&&await window.ai.canCreateTextSession());if(!t){setError(e?"Your browser supports Gemini Nano but you still have to turn on a few features. Please see the Projects page for more information.":"Gemini Nano is not supported by this browser...",!0);let n=document.getElementById("how-to");n&&(n.dataset.help=!0);return}let a=await window.ai.createTextSession(),r=document.getElementById("ask-button"),s=document.getElementById("ask-question"),l=document.getElementById("chat-container");if(!r||!s||!l){setError("Required elements are missing from the page.");return}let i=!1;async function o(){if(i)return;let e=""===s.value.trim()?"Hi there":s.value.trim(),t=document.createElement("div");t.classList.add("chat-message","user-message"),t.innerHTML=`<div class="chat-bubble">${escapeHtml(e)}</div><i class="bi bi-person-fill icon"></i>`,l.appendChild(t);try{i=!0,setError(""),s.value="";let n=await a.prompt(e),r=document.createElement("div");r.classList.add("chat-message","ai-message"),r.innerHTML='<i class="bi bi-robot icon"></i>',renderResponse(n,r),l.appendChild(r),l.scrollTop=l.scrollHeight}catch(o){setError(o.message)}i=!1}r.addEventListener("click",()=>{o()}),document.addEventListener("keydown",e=>{!i&&e.shiftKey&&"Enter"===e.key&&(r.focus(),e.preventDefault(),o())}),document.body.setAttribute("data-ready","true")}catch(c){setError(c.message)}});